import random
import libnum

def calculaD(a, b):
    x2, y2 = 1, 0
    x1, y1 = 0, 1
    x0, y0 = 1, 0

    while b!=0:
        q = int(a / b)
        r = int(a % b)
        a = b
        b = r
        if b!=0:
            x0 = x2 - q * x1
            x2 = x1
            x1 = x0

            y0 = y2 - q * y1
            y2 = y1
            y1 = y0
            
    result = [a, x0, y0]
    return result

def geraE(phiDeN):
    while True:
        e = int(random.randint(2, phiDeN))
        verificaMdc = calculaD(phiDeN, e)

        if verificaMdc[0] == 1:
            return int(e)

def phi(p, q):
    phi = (p-1)*(q-1)
    return phi

def cifra(textoClaro, n, e):
    textoCifrado = pow(textoClaro,e,n)
    return textoCifrado

def decifra(textoCifrado, n, d):
    textoClaro = pow(textoCifrado,d,n)
    return textoClaro

p = libnum.generate_prime(256)
q = libnum.generate_prime(256)
e = geraE(phi(p, q))
n = p * q
texto = [66,101,109,45,118,105,110,100,111,
         32,195,160,32,99,105,100,97,100,101,
         32,102,117,116,117,114,195,173,115,
         116,105,99,97,32,100,101,32,78,101,
         111,84,111,112,105,97,44,32,117,109,
         32,108,117,103,97,114,32,114,101,112,
         108,101,116,111,32,100,101,32,109,97,
         114,97,118,105,108,104,97,115,32,116,
         101,99,110,111,108,195,179,103,105,99,
         97,115,32,101,32,115,117,114,112,114,
         101,115,97,115,32,109,195,161,103,105,
         99,97,115,46,32,69,109,32,109,101,105,
         111,32,97,111,115,32,97,114,114,97,110,
         104,97,45,99,195,169,117,115,32,114,101,
         108,117,122,101,110,116,101,115,32,101,
         32,114,117,97,115,32,105,108,117,109,105,
         110,97,100,97,115,32,112,111,114,32,110,
         195,169,111,110,44,32,117,109,32,112,101,
         114,115,111,110,97,103,101,109,32,112,101,
         99,117,108,105,97,114,32,99,104,97,109,97,
         32,97,32,97,116,101,110,195,167,195,163,
         111,32,100,101,32,116,111,100,111,115,
         58,32,66,101,114,116,111,44,32,97,32,98,
         97,116,97,116,97,32,100,101,32,99,97,114,
         116,111,108,97,46,32,66,101,114,116,111,
         32,195,169,32,117,109,97,32,99,114,105,
         97,116,117,114,97,32,101,110,99,97,110,
         116,97,100,97,32,113,117,101,32,103,97,
         110,104,111,117,32,118,105,100,97,32,103,
         114,97,195,167,97,115,32,195,160,32,102,117,
         115,195,163,111,32,100,101,32,97,118,97,110,
         195,167,97,100,97,32,105,110,116,101,108,105,
         103,195,170,110,99,105,97,32,97,114,116,105,
         102,105,99,105,97,108,32,101,32,97,110,116,
         105,103,111,115,32,102,101,105,116,105,195,
         167,111,115,32,109,195,173,115,116,105,99,
         111,115,46,32,67,111,109,32,115,101,117,32,
         99,104,97,114,109,101,32,101,32,101,115,112,
         195,173,114,105,116,111,32,98,114,105,110,99,
         97,108,104,195,163,111,44,32,66,101,114,116,
         111,32,115,101,32,116,111,114,110,111,117,32,
         111,32,109,97,115,99,111,116,101,32,100,97,32,
         99,105,100,97,100,101,44,32,116,114,97,122,101,
         110,100,111,32,97,108,101,103,114,105,97,32,
         101,32,109,97,103,105,97,32,112,111,114,32,
         111,110,100,101,32,112,97,115,115,97,46,32,
         83,101,117,32,99,111,110,104,101,99,105,109,
         101,110,116,111,32,105,108,105,109,105,116,
         97,100,111,32,101,32,104,97,98,105,108,105,
         100,97,100,101,115,32,109,195,161,103,105,99,
         97,115,32,102,97,122,101,109,32,100,101,108,
         101,32,117,109,32,103,117,105,97,32,105,110,
         99,111,109,112,97,114,195,161,118,101,108,32,
         112,97,114,97,32,101,120,112,108,111,114,97,
         114,32,111,115,32,115,101,103,114,101,100,
         111,115,32,102,117,116,117,114,105,115,116,
         97,115,32,100,101,32,78,101,111,84,111,112,
         105,97,46]

textoDecifrado = []
textoCifrado = []

print("p: ", p, "q: ", q)
print('n: ', n)
print("e: ",e)

d = calculaD(phi(p,q),e)

if(d[2] < 0):
    d = int(d[2]) + phi(p,q)
else:
    d = int(d[2])

print("d: ", d)

for letra in texto:
    textoCifrado.append(cifra(letra, n, e))
print('Texto Cifrado: ', textoCifrado)

for letra in textoCifrado:
    textoDecifrado.append(decifra(letra, n, d))
print('Texto Decifrado: ', textoDecifrado)






